<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subplot</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Supabase -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/supabase-js/2.39.3/umd/index.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-left">
            <div class="logo" onclick="showPage('home')">Subplot</div>
        </div>
        
        <div class="navbar-search">
            <input type="text" class="navbar-search-bar" placeholder="Search..." id="searchInput" autocomplete="off">
            <div id="searchResults" class="navbar-search-results hidden"></div>
        </div>
        
        <div class="navbar-right">
            <div class="nav-links">
                <a href="#" onclick="showPage('home')" class="active" id="home-nav">Home</a>
                <a href="#" onclick="showPage('forums')" id="forums-nav">Forums</a>
                <a href="#" onclick="showPage('profile')" id="profile-nav">Profile</a>
            </div>
            <div id="auth-section">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Left Sidebar -->
        <div class="sidebar-left">
            <!-- Popular Discussions -->
            <div class="sidebar-section">
                <div class="section-header">Popular Threads</div>
                <div class="section-content" id="popularThreads">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="sidebar-section">
                <div class="section-header">Recent Discussion</div>
                <div class="section-content" id="recentDiscussion">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Predictions -->
            <div class="sidebar-section">
                <div class="section-header">Predictions</div>
                <div class="section-content">
                    <div class="list-item">
                        <div class="item-title">Primetime Emmy Awards</div>
                        <div class="item-count">22</div>
                    </div>
                    <div class="list-item">
                        <div class="item-title">Creative Arts Emmy Awards</div>
                        <div class="item-count">18</div>
                    </div>
                    <div class="list-item">
                        <div class="item-title">Gotham Film Awards</div>
                        <div class="item-count">9</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Auth Page -->
            <div id="auth-page" class="page">
                <div class="movie-detail">
                    <div id="authTabs" class="auth-tabs">
                        <button class="auth-tab active" onclick="showAuthForm('login')">Login</button>
                        <button class="auth-tab" onclick="showAuthForm('signup')">Sign Up</button>
                    </div>
                    
                    <div id="loginForm" class="auth-form">
                        <h2>Welcome Back</h2>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="loginEmail" placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password">
                        </div>
                        <button class="btn btn-primary" onclick="handleLogin()" style="width: 100%;">Login</button>
                    </div>
                    
                    <div id="signupForm" class="auth-form hidden">
                        <h2>Join Subplot</h2>
                        <div class="form-group">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-input" id="signupUsername" placeholder="Choose a username">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="signupEmail" placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-input" id="signupPassword" placeholder="Create a password">
                        </div>
                        <button class="btn btn-primary" onclick="handleSignup()" style="width: 100%;">Create Account</button>
                    </div>
                    
                    <div id="authMessage" class="auth-message hidden"></div>
                </div>
            </div>

            <!-- Home Page -->
            <div id="home-page" class="page active">
                <!-- Featured Content -->
                <div class="featured-content">
                    <img src="images/Headline.jpg" alt="Featured" class="featured-image">
                    <div class="featured-overlay">
                        <div class="featured-title">Linus Sandgren to replace Greig Fraser for Dune: Part Three</div>
                        <div class="featured-meta">Cinematographer Greig Fraser, who lensed the last two installments and won an Oscar for his work on the first movie, wouldn't be returning for the third film.</div>
                        <div class="featured-date">August 20 - TODAY</div>
                    </div>
                </div>

                <!-- Content List -->
                <div class="content-list">
                    <div class="content-item" onclick="showMovieDetail(1022789)">
                        <img src="https://image.tmdb.org/t/p/w500/8cdWjvZQUExUUTzyp4t6EDMubfO.jpg" alt="Inside Out 2" class="content-image">
                        <div class="content-info">
                            <div class="content-title">Inside Out 2 dominates box office with $295M opening</div>
                            <div class="content-meta">Animation sequel breaks records • 2h ago</div>
                        </div>
                        <div class="item-count">85</div>
                    </div>

                    <div class="content-item" onclick="showMovieDetail(653346)">
                        <img src="https://image.tmdb.org/t/p/w500/alIy2kM8ryNV7rqoWnvewXgjHnW.jpg" alt="Planet of Apes" class="content-image">
                        <div class="content-info">
                            <div class="content-title">Kingdom of Planet of Apes gets sequel greenlight</div>
                            <div class="content-meta">20th Century Studios confirms • 5h ago</div>
                        </div>
                        <div class="item-count">42</div>
                    </div>

                    <div class="content-item">
                        <img src="https://images.unsplash.com/photo-1536440136628-849c177e76a1?w=120&h=80&fit=crop" alt="Venice" class="content-image">
                        <div class="content-info">
                            <div class="content-title">Venice Film Festival 2025: Early favorites emerge</div>
                            <div class="content-meta">Festival coverage • 1d ago</div>
                        </div>
                        <div class="item-count">156</div>
                    </div>

                    <div class="content-item" onclick="showMovieDetail(519182)">
                        <img src="https://image.tmdb.org/t/p/w500/gKkl37BQuKTanygYQG1pyYgLVgf.jpg" alt="Despicable Me 4" class="content-image">
                        <div class="content-info">
                            <div class="content-title">Despicable Me 4 animation techniques breakdown</div>
                            <div class="content-meta">Behind the scenes • 2d ago</div>
                        </div>
                        <div class="item-count">73</div>
                    </div>

                    <div class="content-item">
                        <img src="https://images.unsplash.com/photo-1440404653325-ab127d49abc1?w=120&h=80&fit=crop" alt="Box Office" class="content-image">
                        <div class="content-info">
                            <div class="content-title">Indie films making surprise box office gains</div>
                            <div class="content-meta">Market analysis • 3d ago</div>
                        </div>
                        <div class="item-count">29</div>
                    </div>
                </div>
            </div>

            <!-- Forums Page -->
            <div id="forums-page" class="page">
                <div class="auth-required-message" id="authRequiredForums" style="display: none; padding: 2rem; text-align: center; background: #333; border-radius: 8px; margin: 1rem;">
                    <h3 style="color: #ff6b35; margin-bottom: 1rem;">Join the Discussion</h3>
                    <p style="color: #ccc; margin-bottom: 1.5rem;">Please login or sign up to participate in forums and create discussions.</p>
                    <button class="btn btn-primary" onclick="showPage('auth')">Login / Sign Up</button>
                </div>

                <button class="create-forum-btn" onclick="showCreateForumForm()" id="createForumBtn">+ Create New Forum</button>
                
                <div id="createForumForm" class="forum-form hidden">
                    <h2 style="margin-bottom: 1.5rem; color: #ff6b35;">Create New Forum</h2>
                    <div class="form-group">
                        <label class="form-label">Forum Title</label>
                        <input type="text" class="form-input" id="forumTitle" placeholder="Enter forum title...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-textarea" id="forumDescription" placeholder="Describe what this forum is about..."></textarea>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="createForum()">Create Forum</button>
                        <button class="btn btn-secondary" onclick="hideCreateForumForm()">Cancel</button>
                    </div>
                </div>

                <div id="forumsList" class="forum-list">
                    <!-- Forums will be dynamically populated here -->
                </div>
            </div>

            <!-- Forum Threads Page -->
            <div id="forum-threads-page" class="page">
                <div class="breadcrumb" id="forumBreadcrumb">
                    <a href="#" onclick="showPage('forums')">Forums</a> > <span id="currentForumName"></span>
                </div>
                
                <div class="auth-required-message" id="authRequiredThreads" style="display: none; padding: 1rem; text-align: center; background: #444; border-radius: 4px; margin: 1rem;">
                    <p style="color: #ccc; margin-bottom: 1rem;">Please login to create threads and participate in discussions.</p>
                    <button class="btn btn-secondary" onclick="showPage('auth')" style="font-size: 0.8rem; padding: 0.5rem 1rem;">Login</button>
                </div>

                <button class="create-forum-btn" onclick="showCreateThreadForm()" id="createThreadBtn">+ Create New Thread</button>
                
                <div id="createThreadForm" class="forum-form hidden">
                    <h2 style="margin-bottom: 1.5rem; color: #ff6b35;">Create New Thread</h2>
                    <div class="form-group">
                        <label class="form-label">Thread Title</label>
                        <input type="text" class="form-input" id="threadTitle" placeholder="Enter thread title...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Content</label>
                        <textarea class="form-textarea" id="threadContent" placeholder="Write your post..."></textarea>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="createThread()">Create Thread</button>
                        <button class="btn btn-secondary" onclick="hideCreateThreadForm()">Cancel</button>
                    </div>
                </div>

                <div id="threadsList" class="thread-list">
                    <!-- Threads will be dynamically populated here -->
                </div>
            </div>

            <!-- Thread Detail Page -->
            <div id="thread-detail-page" class="page">
                <div class="breadcrumb" id="threadBreadcrumb">
                    <a href="#" onclick="showPage('forums')">Forums</a> > 
                    <a href="#" onclick="showForumThreads(currentForumId)" id="forumBreadcrumbLink"></a> > 
                    <span id="currentThreadTitle"></span>
                </div>
                
                <div id="threadDetail" class="movie-detail">
                    <!-- Thread content will be populated here -->
                </div>
                
                <div class="comment-form" id="commentFormSection">
                    <div class="auth-required-message" id="authRequiredComments" style="display: none; padding: 1rem; text-align: center; background: #444; border-radius: 4px; margin-bottom: 1rem;">
                        <p style="color: #ccc; margin-bottom: 1rem;">Please login to comment on this thread.</p>
                        <button class="btn btn-secondary" onclick="showPage('auth')" style="font-size: 0.8rem; padding: 0.5rem 1rem;">Login</button>
                    </div>
                    <div id="commentFormFields">
                        <h3 style="margin-bottom: 1rem; color: #ff6b35;">Add Comment</h3>
                        <textarea class="form-textarea" id="newCommentText" placeholder="Write your comment..."></textarea>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="addComment()">Post Comment</button>
                        </div>
                    </div>
                </div>
                
                <div id="commentsSection" class="comment-section">
                    <!-- Comments will be dynamically populated here -->
                </div>
            </div>

            <!-- Movie Detail Page -->
            <div id="movie-page" class="page">
                <div id="movieContent" class="movie-detail"></div>
            </div>

            <!-- Profile Page -->
            <div id="profile-page" class="page">
                <div class="movie-detail">
                    <div class="auth-required-message" id="authRequiredProfile" style="display: none; padding: 2rem; text-align: center;">
                        <h3 style="color: #ff6b35; margin-bottom: 1rem;">Your Movie Profile</h3>
                        <p style="color: #ccc; margin-bottom: 1.5rem;">Login to track your watched movies, write reviews, and build your personal film collection.</p>
                        <button class="btn btn-primary" onclick="showPage('auth')">Login / Sign Up</button>
                    </div>

                    <div id="profileContent">
                        <h1>Your Profile</h1>
                        <p style="color: #999; margin-bottom: 2rem;">Track your movie watching journey</p>
                        
                        <div style="display: flex; gap: 2rem; margin-bottom: 2rem;">
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; font-weight: bold; color: #ff6b35;" id="filmCount">0</div>
                                <div style="color: #999;">Films Watched</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; font-weight: bold; color: #ff6b35;" id="reviewCount">0</div>
                                <div style="color: #999;">Reviews</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; font-weight: bold; color: #ff6b35;" id="avgRating">0.0</div>
                                <div style="color: #999;">Avg Rating</div>
                            </div>
                        </div>

                        <h2 style="margin-bottom: 1rem;">Recently Watched</h2>
                        <div id="userFilms" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 1rem;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="sidebar-right">
            <!-- Live Screenings -->
            <div class="sidebar-section">
                <div class="section-header">Live Events</div>
                <div class="section-content">
                    <div class="list-item">
                        <div class="item-title">Melbourne International Film Festival</div>
                            <div class="live-indicator">
                            <div class="live-dot"></div>
                            Live
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="item-title">Chichester International Film Festival</div>
                           <div class="live-indicator">
                            <div class="live-dot"></div>
                            Live
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="item-title">Edinburgh International Film Festival</div>
                        <div class="time-indicator">2h 15m</div>
                    </div>
                </div>
            </div>

            <!-- Upcoming Events -->
            <div class="sidebar-section">
                <div class="section-header">Upcoming Events</div>
                <div class="section-content">
                    <div class="list-item" onclick="showMovieDetail(558449)">
                        <div class="item-title">Venice International Film Festival</div>
                        <div class="time-indicator">Aug 27</div>
                    </div>
                    <div class="list-item" onclick="showMovieDetail(933260)">
                        <div class="item-title">Toronto International Film Festival</div>
                        <div class="time-indicator">Sep 4</div>
                    </div>
                    <div class="list-item" onclick="showMovieDetail(1184918)">
                        <div class="item-title">Creative Arts Emmy Awards</div>
                        <div class="time-indicator">Sep 6</div>
                    </div>
                    <div class="list-item" onclick="showMovieDetail(917496)">
                        <div class="item-title">Primetime Emmy Awards</div>
                        <div class="time-indicator">Sep 14</div>
                    </div>
                    <div class="list-item" onclick="showMovieDetail(917496)">
                        <div class="item-title">AFI Fest</div>
                        <div class="time-indicator">Oct 22</div>
                    </div>
                    <div class="list-item" onclick="showMovieDetail(917496)">
                        <div class="item-title">Tokyo International Film Festival</div>
                        <div class="time-indicator">Oct 27</div>
                    </div>
                    <div class="list-item" onclick="showMovieDetail(917496)">
                        <div class="item-title">Gotham Film Awards</div>
                        <div class="time-indicator">Dec 1</div>
                    </div>
                </div>
            </div>

            <!-- Now Playing -->
            <div class="sidebar-section">
                <div class="section-header">Now in Theaters</div>
                <div class="section-content">
                    <div class="list-item" onclick="showMovieDetail(1242011)">
                        <div class="item-title">Together</div>
                        <div class="live-indicator">
                            <div class="live-dot"></div>
                            HOT
                        </div>
                    </div>
                    <div class="list-item" onclick="showMovieDetail(1061474)">
                        <div class="item-title">Superman</div>
                        <div class="item-count">★ 7.6</div>
                    </div>
                    <div class="list-item" onclick="showMovieDetail(911430)">
                        <div class="item-title">F1 The Movie</div>
                        <div class="item-count">★ 7.6</div>
                    </div>
                    <div class="list-item" onclick="showMovieDetail(1078605)">
                        <div class="item-title">Weapons</div>
                        <div class="item-count">★ 7.5</div>
                    </div>
                    <div class="list-item" onclick="showMovieDetail(1136867)">
                        <div class="item-title">Materialists</div>
                    <div class="item-count">★ 6.7</div>
                    </div>
                    <div class="list-item" onclick="showMovieDetail(1239655)">
                        <div class="item-title">Friendship</div>
                        <div class="item-count">★ 6.7</div>
                    </div>
                </div>
            </div>

            <!-- Recent Reviews -->
            <div class="sidebar-section">
                <div class="section-header">Upcoming Releases</div>
                <div class="section-content">
                    <div class="list-item" onclick="showMovieDetail(648878)">
                        <div class="item-title">Eddington</div>
                        <div class="time-indicator">2 days</div>
                    </div>
                    <div class="list-item" onclick="showMovieDetail(1054867)">
                        <div class="item-title">One Battle After Another</div>
                        <div class="time-indicator">Sep 26</div>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="section-header">Awards Results</div>
                <div class="section-content">
                    <div class="list-item">
                        <div class="item-title">Oscars 2025</div>
                        <div class="item-count">★★★★★</div>
                    </div>
                    <div class="list-item">
                        <div class="item-title">BAFTA 2025</div>
                        <div class="item-count">★★★★★</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="utils.js"></script>
    <script src="supabase.js"></script>
    <script src="auth.js"></script>
    <script src="api.js"></script>
    <script src="forum.js"></script>
    <script src="profile.js"></script>
    <script src="main.js"></script>
</body>
</html>